/*!
 * spriteclip v1.0.3
 * 
 * MIT Licensed: https://github.com/wolthers/SpriteClip.js/blob/master/LICENSE.txt
 * 
 * http://moredots.dk/projects/spriteclip/
 * 
 * Copyright (C) 2013 Michael Wolthers Nielsen @michaelwolthers http://moredots.dk/
 */
(function(t){"use strict";function i(t){this._frameRate=t,this.clips=[]}function e(i,s){return this instanceof e?(this.elem=i,this.$elem=t(i),this.$dispatcher=t("<div />"),this._settings=t.extend(!0,{},this._settings,s),this.totalFrames=this._settings.totalFrames,this.frameRate=this._settings.frameRate,this.layout=this._settings.layout,this.frameWidth=this._settings.frameWidth||this.$elem.width()+parseInt(this.$elem.css("padding-left"),10)+parseInt(this.$elem.css("padding-right"),10),this.frameHeight=this._settings.frameHeight||this.$elem.height()+parseInt(this.$elem.css("padding-top"),10)+parseInt(this.$elem.css("padding-bottom"),10),this._validateInitialInput(),void 0):new e(i,s)}var s={ENTER_FRAME:"enterFrame",PLAYING:"playing",STOPPED:"stopped"};i.prototype={clips:void 0,_frameRate:void 0,_timeout:void 0,register:function(t){this.clips.push(t),1===this.clips.length&&this._start()},unregister:function(t){for(var i=this.clips,e=i.length-1;e>=0;e--)if(i[e]===t){i.splice(e,1);break}0===i.length&&this._stop()},_start:function(){this._timeout=setTimeout(t.proxy(this._update,this),1e3/this._frameRate)},_stop:function(){clearTimeout(this._timeout),delete this._timeout},_update:function(){for(var i,e=this.clips,s=e.length-1;s>=0;s--)i=e[s],1===i.currentDirection?i.nextFrame():i.prevFrame(),(i.currentFrame===i._frameToStopAt||i._hasStopAt(i.currentFrame))&&i.stop();this._timeout=setTimeout(t.proxy(this._update,this),1e3/this._frameRate)}};var r=function(){function t(t){var e=t.frameRate;s[e]instanceof i||(s[e]=new i(e)),s[e].register(t)}function e(t){var e=t.frameRate,r=s[e];r instanceof i&&(r.unregister(t),1>r.clips.length&&delete s[e])}var s={};return{register:t,unregister:e}}();e.prototype={elem:void 0,$elem:void 0,$dispatcher:void 0,totalFrames:void 0,frameRate:void 0,currentFrame:1,currentDirection:1,isPlaying:!1,layout:void 0,_timeout:void 0,_frameToStopAt:void 0,_settings:{totalFrames:void 0,frameRate:30,stops:[],layout:"horizontal",frameWidth:void 0,frameHeight:void 0},stops:function(i){if(i!==void 0){if(!(i instanceof Array))throw Error('TypeError: If provided, argument "stops" must be an array.');this._settings.stops=i}return t.extend(!0,[],this._stops)},gotoAndPlay:function(t){this._validateFrameInput(t),this.stop(),this.currentFrame=t,this._showFrame(t),this.play()},gotoAndStop:function(t){this._validateFrameInput(t),this.currentFrame=t,this._showFrame(t),this.stop()},gotoAndRewind:function(t){this._validateFrameInput(t),this.stop(),this.currentFrame=t,this._showFrame(t),this.rewind()},playtoAndStop:function(t){this._validateFrameInput(t),this.play(t,1)},rewindtoAndStop:function(t){this._validateFrameInput(t),this.play(t,-1)},nextFrame:function(){this.currentFrame<this.totalFrames?this.currentFrame+=1:this.currentFrame=1,this._showFrame(this.currentFrame)},prevFrame:function(){this.currentFrame>1?this.currentFrame-=1:this.currentFrame=this.totalFrames,this._showFrame(this.currentFrame)},play:function(t,i){i=-1===i?-1:1,this.isPlaying&&i!==this.currentDirection&&this.stop(),this._frameToStopAt=t,this.currentDirection=i,this.isPlaying||(r.register(this),this.isPlaying=!0,this.$dispatcher.triggerHandler(s.PLAYING))},rewind:function(){this.play(void 0,-1)},stop:function(){this.isPlaying&&(r.unregister(this),this.isPlaying=!1,this.$dispatcher.triggerHandler(s.STOPPED))},_showFrame:function(t){var i,e,r,a=(this.$elem.css("background-position")||this.$elem.css("backgroundPositionX")+" "+this.$elem.css("backgroundPositionY")).split(" ");"horizontal"===this._settings.layout?(i=(t-1)*this.frameWidth,e=-i,r=parseInt(a[1],10)):(i=(t-1)*this.frameHeight,e=parseInt(a[0],10),r=-i),this.$elem.css("background-position",e+"px"+" "+r+"px"),this.$dispatcher.triggerHandler(s.ENTER_FRAME)},_hasStopAt:function(t){for(var i=this._settings.stops.length-1;i>=0;--i)if(this._settings.stops[i]===t)return!0;return!1},_validateFrameInput:function(t){if("number"!=typeof t)throw Error('Argument Error: argument "frame" must be a number.');if(1>t||t>this.totalFrames)throw Error('Argument Error: argument "frame" is out of bounds.')},_validateInitialInput:function(){if("vertical"!==this._settings.layout&&"horizontal"!==this._settings.layout)throw Error('options property "layout" must be either "horizontal" or "vertical".');if(isNaN(parseInt(this.frameRate,10)))throw Error('options property "frameRate" must be parsable as an integer.');if("number"!=typeof this.totalFrames)throw Error('options proberty "totalFrames" must be a number');if("horizontal"===this._settings.layout&&isNaN(this.frameWidth))throw Error("this.frameWidth is not a number. Make sure this.$elem.width() is a Number when we instantiate or pass an explicit value in options.");if("vertical"===this._settings.layout&&isNaN(this.frameHeight))throw Error("this.frameHeight is not a number. Make sure this.$elem.height() is a Number when we instantiate or pass an explicit value in options.")}},window.SpriteClip=e,window.SpriteClipEvent=s,t.fn.spriteClip=function(i){return this.each(function(){t.data(this,"spriteClip")||t(this).data("spriteClip",new e(this,i))})}})(jQuery);